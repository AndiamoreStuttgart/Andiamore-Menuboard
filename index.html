<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Andiamore Menüboard – Board 1</title>
<style>
  :root{
    --refreshMinutes: 0.5; /* 30 Sekunden */
    --safeArea: 0;
  }
  html,body{margin:0;height:100%;background:#000;
    font-family: Impact, "Anton", "Bebas Neue", system-ui, -apple-system, Segoe UI, Roboto, Arial;}
  .stage{position:relative;width:100vw;height:100vh;overflow:hidden;}
  .bg{position:absolute;inset:0;background:center/cover no-repeat;filter:contrast(1.03) saturate(1.03);}
  .overlay{position:absolute;left:var(--safeArea);top:var(--safeArea);right:var(--safeArea);bottom:var(--safeArea);}
  .label{position:absolute;white-space:nowrap;line-height:1;transform:translate(-50%,-50%);}
  .label[data-align="left"]{transform:translate(0,-50%);}
  .label[data-align="right"]{transform:translate(-100%,-50%);}
  .label .txt{font-weight:900;letter-spacing:.5px}
  .shadow .txt{
    text-shadow:0 0 6px rgba(0,0,0,.5),0 0 18px rgba(0,0,0,.35),0 1px 0 rgba(0,0,0,.6);
    -webkit-text-stroke:1px rgba(0,0,0,.35);
  }
  .status{position:absolute;left:20px;bottom:16px;color:#fff;font-weight:600;font-size:16px;opacity:.85}
</style>
</head>
<body>
<div class="stage">
  <!-- HINTERGRUND: belass hier deine bisherige URL oder Data-URI -->
  <div class="bg" style="background-image:url('DEINE_BOARD1_BILD_URL_ODER_DATAURI');"></div>
  <div class="overlay" data-layer="1"></div>
  <div class="status" id="status">Andiamore – Preise laden…</div>
</div>

<script>
  const SHEET_CSV_URL = "DEIN_CSV_LINK_HIER";
  const REFRESH_MS = parseFloat(getComputedStyle(document.documentElement)
                     .getPropertyValue('--refreshMinutes'))*60*1000 || 30000;

  const statusEl = document.getElementById('status');
  let dataRows = [];

  async function fetchCSV(url){
    const res = await fetch(url + '&cb=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error('CSV fetch failed: '+res.status);
    const text = await res.text();
    return parseCSV(text);
  }

  function parseCSV(text){
    const rows=[]; let cur=''; let inQ=false; let row=[];
    for(let i=0;i<text.length;i++){
      const c=text[i];
      if(c==='\"'){ if(inQ && text[i+1]==='\"'){cur+='\"'; i++;} else inQ=!inQ; }
      else if(c===',' && !inQ){ row.push(cur); cur=''; }
      else if((c==='\\n'||c==='\\r') && !inQ){ if(cur!==''||row.length){row.push(cur); rows.push(row); row=[]; cur='';} }
      else cur+=c;
    }
    if(cur!=='' || row.length){ row.push(cur); rows.push(row); }
    if(!rows.length) return [];
    const header = rows.shift().map(h=>h.trim());
    return rows.filter(r=>r.some(x=>x&&x.trim().length)).map(r=>{
      const obj={}; header.forEach((h,i)=> obj[h]=(r[i]||'').trim()); return obj;
    });
  }

  function pctToPos(xpct, ypct, container){
    const rect = container.getBoundingClientRect();
    return {x: rect.width*(parseFloat(xpct)/100), y: rect.height*(parseFloat(ypct)/100)};
  }

  function renderSlide1(){
    const layer = document.querySelector('.overlay[data-layer="1"]');
    layer.innerHTML = '';
    const items = dataRows.filter(r => (r.Slide||'').trim()==='1');
    items.forEach(r=>{
      const node = document.createElement('div');
      node.className = 'label' + ((r.Shadow==='1')?' shadow':'');
      node.dataset.align = (r.Align||'left').toLowerCase();

      const updatePos = ()=>{
        const pos = pctToPos(r.Xpct||0, r.Ypct||0, layer);
        node.style.left = pos.x+'px';
        node.style.top  = pos.y+'px';
      };
      window.addEventListener('resize', updatePos);

      const inner = document.createElement('div');
      inner.className='txt';
      inner.textContent = r.Text || '';
      inner.style.fontSize = (parseFloat(r.FontSize)||72)+'px';
      inner.style.color = r.Color || '#FFFFFF';
      inner.style.fontWeight = r.Weight || '900';
      inner.style.textAlign = (r.Align||'left');

      node.appendChild(inner);
      layer.appendChild(node);
      updatePos();
    });
  }

  async function load(){
    try{
      statusEl.textContent = 'Preise laden…';
      dataRows = await fetchCSV(SHEET_CSV_URL);
      renderSlide1();
      statusEl.textContent = 'Preise aktuell';
    }catch(e){
      console.error(e);
      statusEl.textContent = 'Offline – zeige letzte Ansicht';
    }
  }

  load();
  setInterval(load, REFRESH_MS);
</script>
</body>
</html>
